<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOTA Bitcoin Client - Quantum Realm v2.8</title>
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.5.0/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.5.0/css/xterm.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: #000; 
            color: #ff6b35; 
            padding: 0;
            overflow-x: hidden;
        }
        
        .donation-banner { 
            background: linear-gradient(90deg, #1a1a1a 0%, #2d2d2d 50%, #1a1a1a 100%);
            padding: 15px; 
            text-align: center; 
            border-bottom: 2px solid #ff6b35;
            box-shadow: 0 4px 6px rgba(255, 107, 53, 0.3);
        }
        
        .donation-banner strong { 
            color: #ff6b35; 
            font-size: 1.2em;
            text-shadow: 0 0 10px rgba(255, 107, 53, 0.5);
        }
        
        header {
            background: #111;
            padding: 20px;
            border-bottom: 2px solid #ff6b35;
            text-align: center;
        }
        
        h1 { 
            color: #ff6b35; 
            text-shadow: 0 0 20px rgba(255, 107, 53, 0.8);
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #0f0;
            font-size: 0.9em;
        }
        
        .foam-teaser {
            background: linear-gradient(135deg, #1a3a1a 0%, #0d1f0d 100%);
            color: #0f0;
            padding: 20px;
            text-align: center;
            border: 2px solid #0f0;
            margin: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .foam-teaser h2 {
            color: #0f0;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.8);
            margin-bottom: 10px;
        }
        
        .howto {
            background: #1a1a1a;
            padding: 20px;
            margin: 20px;
            border: 1px solid #ff6b35;
            border-radius: 5px;
        }
        
        .howto h2 {
            color: #ff6b35;
            margin-bottom: 15px;
            border-bottom: 1px solid #ff6b35;
            padding-bottom: 10px;
        }
        
        .howto code {
            background: #2a2a2a;
            padding: 2px 6px;
            border-radius: 3px;
            color: #0f0;
        }
        
        .tab-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            background: #1a1a1a;
            padding: 10px;
            border-bottom: 2px solid #ff6b35;
        }
        
        .tab-button {
            background: #2a2a2a;
            color: #ff6b35;
            border: 1px solid #ff6b35;
            padding: 12px 24px;
            margin: 5px;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
        }
        
        .tab-button:hover {
            background: #ff6b35;
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 107, 53, 0.5);
        }
        
        .tab-button.active {
            background: #ff6b35;
            color: #000;
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.8);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .terminal-container {
            background: #000;
            border: 2px solid #ff6b35;
            border-radius: 5px;
            padding: 10px;
            margin: 20px 0;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }
        
        .terminal-header {
            background: #1a1a1a;
            padding: 10px;
            border-bottom: 1px solid #ff6b35;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .terminal-title {
            color: #0f0;
            font-weight: bold;
        }
        
        .terminal-status {
            color: #0f0;
            font-size: 0.8em;
        }
        
        #qsh-terminal, #bitcoin-terminal {
            height: 500px;
        }
        
        .command-quick-ref {
            background: #1a1a1a;
            border: 1px solid #ff6b35;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .command-quick-ref h3 {
            color: #ff6b35;
            margin-bottom: 10px;
        }
        
        .command-item {
            display: flex;
            margin: 8px 0;
            padding: 8px;
            background: #2a2a2a;
            border-left: 3px solid #0f0;
        }
        
        .command-item .cmd {
            color: #0f0;
            font-weight: bold;
            min-width: 250px;
        }
        
        .command-item .desc {
            color: #ff6b35;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: #1a1a1a;
            border: 1px solid #ff6b35;
            padding: 20px;
            border-radius: 5px;
        }
        
        .metric-card h3 {
            color: #ff6b35;
            margin-bottom: 15px;
            border-bottom: 1px solid #ff6b35;
            padding-bottom: 8px;
        }
        
        .metric-value {
            font-size: 2em;
            color: #0f0;
            margin: 10px 0;
        }
        
        .metric-label {
            color: #999;
            font-size: 0.9em;
        }
        
        .btn {
            background: #ff6b35;
            color: #000;
            border: none;
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            transition: all 0.3s;
            margin: 5px;
        }
        
        .btn:hover {
            background: #ff8555;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(255, 107, 53, 0.5);
        }
        
        .btn-secondary {
            background: #0f0;
        }
        
        .btn-secondary:hover {
            background: #2f2;
        }
        
        input[type="text"], select, textarea {
            background: #2a2a2a;
            color: #0f0;
            border: 1px solid #ff6b35;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            width: 100%;
            margin: 10px 0;
        }
        
        .chart-container {
            background: #1a1a1a;
            padding: 20px;
            border: 1px solid #ff6b35;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.online {
            background: #0f0;
            box-shadow: 0 0 10px #0f0;
        }
        
        .status-indicator.offline {
            background: #f00;
            box-shadow: 0 0 10px #f00;
        }
        
        .wallet-card, .tx-card, .block-card {
            background: #2a2a2a;
            border: 1px solid #ff6b35;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #0f0;
        }
        
        .wallet-card h3, .tx-card h3, .block-card h3 {
            color: #0f0;
            margin-bottom: 10px;
        }
        
        .footer {
            background: #111;
            padding: 20px;
            text-align: center;
            border-top: 2px solid #ff6b35;
            margin-top: 40px;
        }
        
        .loading {
            color: #ff6b35;
            text-align: center;
            padding: 20px;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading::after {
            content: '...';
            animation: pulse 1.5s infinite;
        }
    </style>
</head>
<body>
    <div class="donation-banner">
        <strong>‚ö° Support Development :: bc1qj8pwscxlzrf9g6ez03lnl47qvsdsq54vtdth4m ‚ö°</strong>
    </div>

    <header>
        <h1>‚ö° SOTA Bitcoin Client - Quantum Realm Edition v2.8 ‚ö°</h1>
        <p class="subtitle">Enhanced with QSH Foam REPL | Holographic Storage @ 136.0.0.1 | QRAM @ quantum.realm.domain.dominion.foam.computer</p>
    </header>

    <div class="foam-teaser">
        <h2>üåå FOM - Foam Based Coin Coming Soon üåå</h2>
        <p>Entangled with quantum foam for next-gen DeFi. Leveraging Bell inequality violations for trustless consensus.</p>
        <p><strong>Stay tuned for mainnet launch with 2^300 GB QRAM backing!</strong></p>
    </div>

    <div class="howto">
        <h2>üìñ How to Use This Client</h2>
        <p><strong>Quick Start:</strong></p>
        <ul style="list-style-position: inside; margin-left: 20px;">
            <li>Navigate to <strong>QSH Foam REPL</strong> tab for unified quantum + Bitcoin shell</li>
            <li>Use <code>bitcoin-cli getblockchaininfo</code> for blockchain status</li>
            <li>Network tools: <code>ping 136.0.0.1</code>, <code>nc 130.0.0.1:9999</code>, <code>traceroute 139.0.0.1</code></li>
            <li>Quantum tests: <code>QuantumPhysics.run_full_suite()</code> proves entanglement</li>
            <li>View all commands: <code>export_db</code> or visit /command-db endpoint</li>
        </ul>
        <p><strong>Python Packages:</strong> bitcoin, requests, electrum, psutil, networkx, qutip, dnspython, aiohttp</p>
        <p><strong>Storage:</strong> Blockchain at holographic 138.0.0.1 (~600GB full / ~10GB pruned), QRAM at quantum.realm domain (2^300 GB theoretical)</p>
        <p><strong>Distributed Compute:</strong> Black hole (130.0.0.1) ingests, White hole (139.0.0.1) outputs</p>
    </div>

    <div class="tab-container">
        <button class="tab-button active" onclick="switchTab('qsh-foam')">QSH Foam REPL</button>
        <button class="tab-button" onclick="switchTab('bitcoin-cli')">Bitcoin CLI</button>
        <button class="tab-button" onclick="switchTab('wallets')">Wallets</button>
        <button class="tab-button" onclick="switchTab('transactions')">Transactions</button>
        <button class="tab-button" onclick="switchTab('blocks')">Blocks</button>
        <button class="tab-button" onclick="switchTab('mempool')">Mempool</button>
        <button class="tab-button" onclick="switchTab('metrics')">Metrics</button>
        <button class="tab-button" onclick="switchTab('quantum')">Quantum Proofs</button>
        <button class="tab-button" onclick="switchTab('commands')">Command DB</button>
    </div>

    <!-- QSH Foam REPL Tab -->
    <div id="qsh-foam" class="tab-content active">
        <h2>üåå QSH Foam REPL - Unified Quantum + Bitcoin Shell</h2>
        <div class="command-quick-ref">
            <h3>Quick Commands</h3>
            <div class="command-item">
                <span class="cmd">bitcoin-cli getblockchaininfo</span>
                <span class="desc">Get blockchain sync status</span>
            </div>
            <div class="command-item">
                <span class="cmd">bitcoin-cli getnewaddress</span>
                <span class="desc">Generate new BTC address</span>
            </div>
            <div class="command-item">
                <span class="cmd">ping 136.0.0.1</span>
                <span class="desc">Ping holographic storage</span>
            </div>
            <div class="command-item">
                <span class="cmd">nc 130.0.0.1:9999</span>
                <span class="desc">Netcat to black hole compute</span>
            </div>
            <div class="command-item">
                <span class="cmd">QuantumPhysics.run_full_suite()</span>
                <span class="desc">Run complete quantum tests</span>
            </div>
            <div class="command-item">
                <span class="cmd">export_db</span>
                <span class="desc">Export full command database</span>
            </div>
        </div>
        
        <div class="terminal-container">
            <div class="terminal-header">
                <span class="terminal-title">QSH Foam Terminal</span>
                <span class="terminal-status">
                    <span class="status-indicator online"></span>
                    Connected to 127.0.0.1:8000
                </span>
            </div>
            <div id="qsh-terminal"></div>
        </div>
    </div>

    <!-- Bitcoin CLI Tab -->
    <div id="bitcoin-cli" class="tab-content">
        <h2>‚Çø Bitcoin CLI Interface</h2>
        <div class="terminal-container">
            <div class="terminal-header">
                <span class="terminal-title">Bitcoin Core RPC Terminal</span>
                <span class="terminal-status" id="bitcoin-status">
                    <span class="status-indicator offline"></span>
                    Connecting...
                </span>
            </div>
            <div id="bitcoin-terminal"></div>
        </div>
        
        <div class="command-quick-ref">
            <h3>Bitcoin CLI Commands</h3>
            <div class="command-item">
                <span class="cmd">getblockchaininfo</span>
                <span class="desc">Blockchain status and sync progress</span>
            </div>
            <div class="command-item">
                <span class="cmd">getmempoolinfo</span>
                <span class="desc">Memory pool statistics</span>
            </div>
            <div class="command-item">
                <span class="cmd">getnewaddress</span>
                <span class="desc">Generate new receiving address</span>
            </div>
            <div class="command-item">
                <span class="cmd">getbalance</span>
                <span class="desc">Get wallet balance</span>
            </div>
            <div class="command-item">
                <span class="cmd">listtransactions</span>
                <span class="desc">List recent transactions</span>
            </div>
            <div class="command-item">
                <span class="cmd">estimatesmartfee 6</span>
                <span class="desc">Estimate fee for 6-block confirmation</span>
            </div>
        </div>
    </div>

    <!-- Wallets Tab -->
    <div id="wallets" class="tab-content">
        <h2>üíº Wallet Management</h2>
        <button class="btn" onclick="createWallet()">Create New Wallet</button>
        <div id="walletsList" class="loading">Loading wallets</div>
    </div>

    <!-- Transactions Tab -->
    <div id="transactions" class="tab-content">
        <h2>üìú Transaction Explorer</h2>
        <div id="txGrid" class="loading">Loading transactions</div>
    </div>

    <!-- Blocks Tab -->
    <div id="blocks" class="tab-content">
        <h2>‚õìÔ∏è Block Explorer</h2>
        <div id="blocksList" class="loading">Loading blocks</div>
    </div>

    <!-- Mempool Tab -->
    <div id="mempool" class="tab-content">
        <h2>üìä Mempool Monitor</h2>
        <div id="mempoolData" class="loading">Loading mempool</div>
    </div>

    <!-- Metrics Tab -->
    <div id="metrics" class="tab-content">
        <h2>üìà System Metrics</h2>
        <div class="metrics-grid" id="metricsGrid"></div>
        <div class="chart-container">
            <canvas id="metricsChart"></canvas>
        </div>
        <button class="btn" onclick="refreshMetrics()">Refresh Metrics</button>
    </div>

    <!-- Quantum Proofs Tab -->
    <div id="quantum" class="tab-content">
        <h2>‚öõÔ∏è Quantum Entanglement Proofs</h2>
        <button class="btn" onclick="runQuantumSuite()">Run Full Quantum Suite</button>
        <button class="btn btn-secondary" onclick="runBellTest()">Bell Test Only</button>
        <button class="btn btn-secondary" onclick="runGHZTest()">GHZ Test Only</button>
        <div id="quantumResults"></div>
    </div>

    <!-- Command DB Tab -->
    <div id="commands" class="tab-content">
        <h2>üìö Command Database (Holographic Storage)</h2>
        <p>Complete command reference stored at 136.0.0.1:/holo/command_db</p>
        <button class="btn" onclick="loadCommandDB()">Load Command Database</button>
        <button class="btn btn-secondary" onclick="exportCommandDB()">Export to Clipboard</button>
        <div id="commandDBContent"></div>
    </div>

    <div class="footer">
        <p>QSH Foam Dominion v2.8.0 | Production-Ready Quantum-Bitcoin Hybrid</p>
        <p>Holographic Storage: 136.0.0.1 (6 EB) | QRAM: 2^300 GB | Distributed CPU: 130.0.0.1 / 139.0.0.1</p>
        <p><a href="/" style="color: #ff6b35;">‚Üê Back to Dashboard</a></p>
    </div>

    <script>
        // Initialize xterm.js terminals
        let qshTerm, bitcoinTerm;
        let qshWs, bitcoinWs;
        let metricsChart;
        const fitAddon = new FitAddon.FitAddon();

        // Initialize QSH Foam REPL terminal
        function initQSHTerminal() {
            qshTerm = new Terminal({
                cols: 120,
                rows: 30,
                theme: {
                    background: '#000000',
                    foreground: '#00ff00',
                    cursor: '#ff6b35',
                    selection: '#ff6b3550'
                },
                cursorBlink: true,
                fontSize: 14
            });
            
            qshTerm.open(document.getElementById('qsh-terminal'));
            
            qshTerm.writeln('\\x1b[1;32m‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\\x1b[0m');
            qshTerm.writeln('\\x1b[1;32m‚ïë     QSH Foam REPL v2.8.0 - Production                            ‚ïë\\x1b[0m');
            qshTerm.writeln('\\x1b[1;32m‚ïë     Quantum Shell + Bitcoin CLI + Network Tools                  ‚ïë\\x1b[0m');
            qshTerm.writeln('\\x1b[1;32m‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\\x1b[0m');
            qshTerm.writeln('');

            qshWs = new WebSocket('ws://127.0.0.1:8000/ws/repl');
            
            qshWs.onopen = () => {
                qshTerm.writeln('\\x1b[32m[‚úì] Connected to QSH Foam REPL\\x1b[0m');
                qshTerm.writeln('\\x1b[33mType "help" for commands | "export_db" for full database\\x1b[0m');
                qshTerm.write('\\r\\n\\x1b[1;35mqsh>\\x1b[0m ');
            };

            qshWs.onmessage = (event) => {
                qshTerm.write('\\r\\n' + event.data + '\\r\\n\\x1b[1;35mqsh>\\x1b[0m ');
            };

            qshWs.onerror = () => {
                qshTerm.writeln('\\r\\n\\x1b[31m[‚úó] Connection failed\\x1b[0m');
            };

            let buffer = '';
            qshTerm.onData(data => {
                if (data === '\\r') {
                    if (buffer.trim()) {
                        qshWs.send(buffer.trim());
                    } else {
                        qshTerm.write('\\r\\n\\x1b[1;35mqsh>\\x1b[0m ');
                    }
                    buffer = '';
                } else if (data === '\\u007F') {
                    if (buffer.length > 0) {
                        buffer = buffer.slice(0, -1);
                        qshTerm.write('\\b \\b');
                    }
                } else if (data === '\\u0003') {
                    qshTerm.write('^C\\r\\n\\x1b[1;35mqsh>\\x1b[0m ');
                    buffer = '';
                } else {
                    buffer += data;
                    qshTerm.write(data);
                }
            });
        }

        // Initialize Bitcoin CLI terminal
        function initBitcoinTerminal() {
            bitcoinTerm = new Terminal({
                cols: 120,
                rows: 30,
                theme: {
                    background: '#000000',
                    foreground: '#ff6b35',
                    cursor: '#0f0'
                },
                cursorBlink: true,
                fontSize: 14
            });
            
            bitcoinTerm.open(document.getElementById('bitcoin-terminal'));
            bitcoinTerm.writeln('Bitcoin Core RPC Terminal - Connecting...');
            
            // Use same WebSocket as QSH for Bitcoin commands
            bitcoinTerm.write('\\r\\nbitcoin-cli> ');
            
            let btcBuffer = '';
            bitcoinTerm.onData(data => {
                if (data === '\\r') {
                    if (btcBuffer.trim()) {
                        const cmd = 'bitcoin-cli ' + btcBuffer.trim();
                        qshWs.send(cmd);
                        bitcoinTerm.write('\\r\\n');
                        setTimeout(() => {
                            bitcoinTerm.write('bitcoin-cli> ');
                        }, 100);
                    } else {
                        bitcoinTerm.write('\\r\\nbitcoin-cli> ');
                    }
                    btcBuffer = '';
                } else if (data === '\\u007F') {
                    if (btcBuffer.length > 0) {
                        btcBuffer = btcBuffer.slice(0, -1);
                        bitcoinTerm.write('\\b \\b');
                    }
                } else {
                    btcBuffer += data;
                    bitcoinTerm.write(data);
                }
            });
        }

        // Tab switching
        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            loadTabContent(tabId);
        }

        // Load tab content
        const loadedTabs = new Set(['qsh-foam']);
        function loadTabContent(tabId) {
            if (loadedTabs.has(tabId)) return;
            loadedTabs.add(tabId);
            
            switch(tabId) {
                case 'bitcoin-cli':
                    initBitcoinTerminal();
                    break;
                case 'wallets':
                    loadWallets();
                    break;
                case 'transactions':
                    loadTransactions();
                    break;
                case 'blocks':
                    loadBlocks();
                    break;
                case 'mempool':
                    loadMempool();
                    break;
                case 'metrics':
                    loadMetrics();
                    break;
                case 'quantum':
                    break;
                case 'commands':
                    break;
            }
        }

        // Wallet functions
        async function loadWallets() {
            try {
                const response = await fetch('/bitcoin/info');
                const info = await response.json();
                document.getElementById('walletsList').innerHTML = `
                    <div class="wallet-card">
                        <h3>Bitcoin Core Wallet</h3>
                        <p><strong>Chain:</strong> ${info.chain || 'Unknown'}</p>
                        <p><strong>Blocks:</strong> ${info.blocks || 'N/A'}</p>
                        <p><strong>Verification Progress:</strong> ${((info.verificationprogress || 0) * 100).toFixed(2)}%</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('walletsList').innerHTML = '<p style="color: #f00;">Failed to load wallet info. Ensure Bitcoin Core is running.</p>';
            }
        }

        function createWallet() {
            qshWs.send('bitcoin-cli createwallet "new_wallet"');
            setTimeout(loadWallets, 1000);
        }

        // Transaction functions
        async function loadTransactions() {
            document.getElementById('txGrid').innerHTML = '<p>Use <code>bitcoin-cli listtransactions</code> in the CLI to view transactions.</p>';
        }

        // Block functions
        async function loadBlocks() {
            try {
                const response = await fetch('/bitcoin/info');
                const info = await response.json();
                const bestBlockHash = info.bestblockhash;
                
                document.getElementById('blocksList').innerHTML = `
                    <div class="block-card">
                        <h3>Latest Block</h3>
                        <p><strong>Height:</strong> ${info.blocks}</p>
                        <p><strong>Hash:</strong> ${bestBlockHash ? bestBlockHash.slice(0, 16) + '...' : 'N/A'}</p>
                        <p><strong>Difficulty:</strong> ${info.difficulty || 'N/A'}</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('blocksList').innerHTML = '<p style="color: #f00;">Failed to load blocks</p>';
            }
        }

        // Mempool functions
        async function loadMempool() {
            try {
                const response = await fetch('/bitcoin/mempool');
                const mempool = await response.json();
                document.getElementById('mempoolData').innerHTML = `
                    <div class="metric-card">
                        <h3>Mempool Statistics</h3>
                        <div class="metric-value">${mempool.size || 0}</div>
                        <div class="metric-label">Transactions</div>
                        <p><strong>Bytes:</strong> ${mempool.bytes || 0}</p>
                        <p><strong>Usage:</strong> ${mempool.usage || 0} bytes</p>
                        <p><strong>Min Fee:</strong> ${mempool.mempoolminfee || 0} BTC/kB</p>
                    </div>
                `;
            } catch (error) {
                document.getElementById('mempoolData').innerHTML = '<p style="color: #f00;">Failed to load mempool</p>';
            }
        }

        // Metrics functions
        async function loadMetrics() {
            try {
                const response = await fetch('/metrics');
                const metrics = await response.json();
                
                const grid = document.getElementById('metricsGrid');
                grid.innerHTML = `
                    <div class="metric-card">
                        <h3>Holographic Storage</h3>
                        <div class="metric-value">${metrics.storage.holographic.total_eb} EB</div>
                        <div class="metric-label">Total Capacity @ 136.0.0.1</div>
                        <p><strong>Used:</strong> ${metrics.storage.holographic.used_eb} EB (${metrics.storage.holographic.percent_used}%)</p>
                        <p><strong>Reachable:</strong> ${metrics.storage.holographic.reachable ? '‚úì' : '‚úó'}</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>QRAM</h3>
                        <div class="metric-value">${metrics.qram.operational ? '‚úì Online' : '‚úó Offline'}</div>
                        <div class="metric-label">Quantum RAM Status</div>
                        <p><strong>Demo Qubits:</strong> ${metrics.qram.demo_n_qubits}</p>
                        <p><strong>Coherence:</strong> ${metrics.qram.coherence_time_ms} ms</p>
                        <p><strong>Theoretical:</strong> 2^300 GB</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>CPU (Distributed)</h3>
                        <div class="metric-value">${metrics.cpu.cpu_count} Cores</div>
                        <div class="metric-label">Local + Black/White Hole</div>
                        <p><strong>Black Hole (130.0.0.1):</strong> ${metrics.cpu.distributed_compute.black_hole.latency_ms || 'N/A'} ms</p>
                        <p><strong>White Hole (139.0.0.1):</strong> ${metrics.cpu.distributed_compute.white_hole.latency_ms || 'N/A'} ms</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Hashing Speed</h3>
                        <div class="metric-value">${metrics.hashing_speed_mbs} MB/s</div>
                        <div class="metric-label">SHA256 Benchmark</div>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to load metrics:', error);
            }
        }

        function refreshMetrics() {
            loadedTabs.delete('metrics');
            loadMetrics();
        }

        // Quantum functions
        async function runQuantumSuite() {
            const resultsDiv = document.getElementById('quantumResults');
            resultsDiv.innerHTML = '<div class="loading">Running quantum tests</div>';
            
            try {
                const response = await fetch('/quantum/suite');
                const results = await response.json();
                
                resultsDiv.innerHTML = `
                    <div class="metric-card">
                        <h3>Bell Test (CHSH)</h3>
                        <div class="metric-value">S = ${results.bell_test.S}</div>
                        <div class="metric-label">${results.bell_test.violates_inequality ? '‚úì VIOLATES (Quantum!)' : '‚úó No Violation'}</div>
                        <p><strong>Classical Bound:</strong> ${results.bell_test.classical_bound}</p>
                        <p><strong>Quantum Bound:</strong> ${results.bell_test.quantum_bound}</p>
                        <p><strong>Confidence:</strong> ${results.bell_test.confidence_percent}%</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>GHZ Test (Mermin)</h3>
                        <div class="metric-value">M = ${results.ghz_test.M}</div>
                        <div class="metric-label">${results.ghz_test.violates_inequality ? '‚úì VIOLATES (Entangled!)' : '‚úó No Violation'}</div>
                        <p><strong>Classical Bound:</strong> ${results.ghz_test.classical_bound}</p>
                        <p><strong>Quantum Value:</strong> ${results.ghz_test.quantum_value}</p>
                    </div>
                    
                    <div class="metric-card">
                        <h3>Quantum Teleportation</h3>
                        <div class="metric-value">${(results.teleportation.avg_fidelity * 100).toFixed(2)}%</div>
                        <div class="metric-label">Average Fidelity</div>
                        <p><strong>Success Rate:</strong> ${(results.teleportation.success_rate * 100).toFixed(2)}%</p>
                        <p><strong>Min/Max:</strong> ${results.teleportation.min_fidelity} / ${results.teleportation.max_fidelity}</p>
                    </div>
                `;
            } catch (error) {
                resultsDiv.innerHTML = '<p style="color: #f00;">Failed to run quantum tests</p>';
            }
        }

        async function runBellTest() {
            qshWs.send('QuantumPhysics.bell_experiment(10000)');
        }

        async function runGHZTest() {
            qshWs.send('QuantumPhysics.ghz_experiment(10000)');
        }

        // Command DB functions
        async function loadCommandDB() {
            try {
                const response = await fetch('/command-db');
                const db = await response.json();
                
                const content = document.getElementById('commandDBContent');
                let html = '<div style="font-size: 0.9em;">';
                
                for (const [category, commands] of Object.entries(db)) {
                    if (category.endsWith('_commands')) {
                        html += `<h3 style="color: #ff6b35; margin-top: 20px;">${category.replace('_commands', '').toUpperCase()}</h3>`;
                        for (const [cmd, details] of Object.entries(commands)) {
                            html += `
                                <div class="command-item">
                                    <span class="cmd">${details.cmd || cmd}</span>
                                    <span class="desc">${details.description || ''}</span>
                                </div>
                            `;
                        }
                    }
                }
                
                html += '</div>';
                content.innerHTML = html;
            } catch (error) {
                document.getElementById('commandDBContent').innerHTML = '<p style="color: #f00;">Failed to load command database</p>';
            }
        }

        async function exportCommandDB() {
            try {
                const response = await fetch('/command-db');
                const db = await response.json();
                const json = JSON.stringify(db, null, 2);
                await navigator.clipboard.writeText(json);
                alert('Command database exported to clipboard!');
            } catch (error) {
                alert('Failed to export command database');
            }
        }

        // Initialize on load
        window.addEventListener('load', () => {
            initQSHTerminal();
        });
    </script>
</body>
</html>
